<%
    json = {
      "organization": current_organization,
      "location": current_location,
      "hostgroups": @hostgroups,
      "ansibleGroups": @ansible_groups,
      "foremanDataUrl": ui_acd_foreman_data_path("__id__"),
      "ansibleDataUrl": ui_acd_ansible_data_path(:playbook_id => "__id__", :group_name => "__subid__"),
      "services": [],
      "ansibleVarsAll": [],
    }

    if @app_definition.services.present?
      json["services"] = JSON.parse(@app_definition.services)
    end

    if @app_definition.ansible_vars_all.present?
      json["ansibleVarsAll"] = JSON.parse(@app_definition.ansible_vars_all)
    end
%>

<%= form_for @app_definition, :url => (@app_definition.new_record? ? app_definitions_path : app_definition_path(:id => @app_definition.id)) do |f| %>
  <%= base_errors_for @app_definition %>
  <ul class="nav nav-tabs" data-tabs="tabs">
    <li class="active"><a href="#primary" data-toggle="tab"><%= _('Application Definitions') %></a></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane active" id="primary">
      <%= text_f f, :name %>
      <%= text_f f, :description %>
      <%= select_f f, :acd_ansible_playbook_id, ForemanAcd::AnsiblePlaybook.all, :id, :name, {}, { :label => _("Ansible Playbook"), :disabled => !@app_definition.new_record? } %>

      <div id='app_definition'></div>
      <%=  mount_react_component('ApplicationDefinition', "#app_definition", json.to_json) %>
    </div>
  </div>

  <%= submit_or_cancel f %>
<% end %>
