<%#
kind: job_template
name: Run ACD Ansible Playbook - SSH Default
model: JobTemplate
job_category: Ansible
description_format: "Run Ansible playbook %{playbook_name} for ACD application %{application_name}"
provider_type: SSH
feature: run_acd_ansible_playbook
template_inputs:
- name: application_name
  description: The name of the ACD application instance to run
  input_type: user
  required: true
  advanced: false
- name: playbook_name
  description: The name of the Ansible playbook to run
  input_type: user
  required: true
  advanced: false
- name: playbook_path
  description: The full path to the Ansible playbook
  input_type: user
  required: true
  advanced: false
- name: inventory
  description: The Ansible inventory
  input_type: user
  required: true
  advanced: false
%>

INVENTORY_FILE=$(tempfile -p "acd_")
cat << EOF >$INVENTORY_FILE
<%= input('inventory') %>
EOF

echo "Run ansible-playbook <%= input('playbook_name') %> to configure ACD app <%= input('application_name') %>"
ansible-playbook -i $INVENTORY_FILE <%= input('playbook_path') %>
